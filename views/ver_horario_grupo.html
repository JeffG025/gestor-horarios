<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horario de Grupo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style> body { background-color: #f8f9fa; } .table-xs { font-size: 0.75rem; } </style>
</head>
<body class="p-2">

    <div class="card shadow-sm">
        <div class="card-header bg-success text-white text-center py-2">
            <h5 class="mb-0 fs-6">ðŸ“… Horario de Grupo</h5>
            <h4 id="lblGrupo" class="fw-bold mt-1">Cargando...</h4>
        </div>
        
        <div class="table-responsive">
            <table class="table table-bordered table-striped text-center table-xs mb-0">
                <thead class="table-secondary">
                    <tr><th>Hr</th><th>Lun</th><th>Mar</th><th>MiÃ©</th><th>Jue</th><th>Vie</th></tr>
                </thead>
                <tbody id="tablaCuerpo"></tbody>
            </table>
        </div>
        
        <div class="card-footer text-center">
            <small class="text-muted" style="font-size: 10px;">Instituto TecnolÃ³gico</small>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const idGrupo = params.get('id');
            const nombreGrupo = params.get('nombre');

            if(nombreGrupo) document.getElementById('lblGrupo').innerText = nombreGrupo;

            // 1. Generar Tabla VacÃ­a
            const generarTabla = () => {
                const horas = [7, 8, 9, 10, 11, 12, 13, 14];
                let html = '';
                horas.forEach(h => {
                    const horaF = `${h.toString().padStart(2, '0')}:00`;
                    html += `<tr>
                        <td class="fw-bold bg-light">${horaF}</td>
                        <td id="cell-Lunes-${h}"></td><td id="cell-Martes-${h}"></td>
                        <td id="cell-Miercoles-${h}"></td><td id="cell-Jueves-${h}"></td>
                        <td id="cell-Viernes-${h}"></td>
                    </tr>`;
                });
                document.getElementById('tablaCuerpo').innerHTML = html;
            };

            // 2. Cargar Datos
            const cargarHorario = async () => {
                if(!idGrupo) return;
                try {
                    // Headers para ngrok por si acaso
                    const res = await fetch(`/api/horario/grupo/${idGrupo}`, {
                        headers: new Headers({ "ngrok-skip-browser-warning": "69420" })
                    });
                    const clases = await res.json();
                    
                    generarTabla(); // Limpiar

                    clases.forEach(c => {
                        const h = parseInt(c.hora_inicio.split(':')[0]);
                        const celda = document.getElementById(`cell-${c.dia_semana}-${h}`);
                        if (celda) {
                            celda.innerHTML = `<b class="d-block text-truncate">${c.asignatura}</b>
                                               <span class="badge bg-primary">${c.maestro}</span><br>
                                               <small class="text-muted">Aula: ${c.nombre_aula}</small>`;
                            celda.classList.add('table-success'); 
                        }
                    });
                } catch (error) { console.error(error); }
            };

            generarTabla();
            cargarHorario();
        });
    </script>
</body>
</html>